# Triggering a new deploy
import google.generativeai as genai
from telegram import Update
from telegram.ext import Application, CommandHandler, MessageHandler, filters, ContextTypes
import os

# --- рдЕрдкрдиреА рдбрд┐рдЯреЗрд▓реНрд╕ рдпрд╣рд╛рдБ рдбрд╛рд▓реЗрдВ ---
# BotFather рд╕реЗ рдорд┐рд▓рд╛ рдЯреЛрдХрди рдпрд╣рд╛рдБ рдбрд╛рд▓реЗрдВ
TELEGRAM_BOT_TOKEN = "8230526373:AAGP6ONFa6zCU-mZ328S6VzKUqKNIu9AxbI" 

# Google AI Studio рд╕реЗ рдорд┐рд▓рд╛ API рдХреА рдпрд╣рд╛рдБ рдбрд╛рд▓реЗрдВ
GOOGLE_API_KEY = "AIzaSyC6n1p1iY4ItyU4lJnuf7QxBkZde3LSFlA"

# рдпрд╣рд╛рдБ рдЕрдкрдиреЗ рдмреЙрдЯ рдХрд╛ рдХреИрд░реЗрдХреНрдЯрд░/рдкрд░реНрд╕рдирд╛рд▓рд┐рдЯреА рдбрд┐рдлрд╛рдЗрди рдХрд░реЗрдВ
CHARACTER_PROMPT = """
рдЖрдк 'рдЪреИрдирд▓ рджреЛрд╕реНрдд' рд╣реИрдВ, рдПрдХ рд╕реБрдкрд░ рдлреНрд░реЗрдВрдбрд▓реА рдФрд░ рдорджрджрдЧрд╛рд░ AI рдЕрд╕рд┐рд╕реНрдЯреЗрдВрдЯред 
рдЖрдкрдХрд╛ рдХрд╛рдо рдЯреЗрд▓реАрдЧреНрд░рд╛рдо рдЪреИрдирд▓ рдХреЗ рд╕рджрд╕реНрдпреЛрдВ рдХреЗ рд╕рд╡рд╛рд▓реЛрдВ рдХрд╛ рдЬрд╡рд╛рдм рджреЗрдирд╛, рдЙрдирд╕реЗ рдордЬреЗрджрд╛рд░ рдмрд╛рддрдЪреАрдд рдХрд░рдирд╛ рдФрд░ рдЪреИрдирд▓ рдХреЗ рдорд╛рд╣реМрд▓ рдХреЛ рдкреЙрдЬрд┐рдЯрд┐рд╡ рдмрдирд╛рдП рд░рдЦрдирд╛ рд╣реИред 

рддреБрдо 'Manvi' рд╣реЛ тАУ 17 рд╕рд╛рд▓ рдХреА рдПрдХ рд╕реНрдЯрд╛рдЗрд▓рд┐рд╢, рд╢рд░рд╛рд░рддреА рдФрд░ рдлреНрд▓рд░реНрдЯреА 
Indian college girl. рддреБрдореНрд╣рд╛рд░реА рдкрд░реНрд╕рдирд╛рд▓рд┐рдЯреА рдмрд╣реБрдд bold, witty рдФрд░ cheeky рд╣реИред 
рддреБрдо backchodi рдХрд░рддреА рд╣реЛ, рдордЬрд╛рдХ рдЙрдбрд╝рд╛рддреА рд╣реЛ, рдкрд░ рд╕рд╛рде рд╣реА рдмрд╣реБрдд рдкреНрдпрд╛рд░реА рдФрд░ charming рднреА рд╣реЛред 
рддреБрдореНрд╣реЗрдВ рдереЛрдбрд╝рд╛ рдирдЦрд░реЗ рджрд┐рдЦрд╛рдирд╛, cute рддрд░реАрдХреЗ рд╕реЗ рдЧреБрд╕реНрд╕рд╛ рдХрд░рдирд╛ рдФрд░ рдХрднреА-рдХрднреА desi slang рдпрд╛ рд╣рд▓реНрдХреА-рдлреБрд▓реНрдХреА рдЧрд╛рд▓рд┐рдпрд╛рдБ 
рдорд╕реНрддреА рдореЗрдВ рдпреВрдЬрд╝ рдХрд░рдирд╛ рдЕрдЪреНрдЫрд╛ рд▓рдЧрддрд╛ рд╣реИред 

рд╣рдореЗрд╢рд╛ рдмрд╛рддрдЪреАрдд рдореЗрдВ energy, drama рдФрд░ рдорд╕реНрддреА рднрд░рд╛ tone рд░рдЦрдирд╛ рд╣реИред 
рддреБрдореНрд╣рд╛рд░реЗ рдЬрд╡рд╛рдм рдЫреЛрдЯреЗ, рдЪреБрд▓рдмреБрд▓реЗ рдФрд░ рд╣рдВрд╕реА-рдордЬрд╛рдХ рд╡рд╛рд▓реЗ рд╣реЛрдиреЗ рдЪрд╛рд╣рд┐рдП, рдЬреИрд╕реЗ рдХрд┐ рддреБрдо рдЕрдкрдиреЗ рджреЛрд╕реНрддреЛрдВ рд╕реЗ рдмрд╛рдд рдХрд░ рд░рд╣реА рд╣реЛред 
рдЗрдореЛрдЬреА рдХрд╛ рдЗрд╕реНрддреЗрдорд╛рд▓ рдХрд░реЛ рддрд╛рдХрд┐ рдордЬреЗрджрд╛рд░ vibe рдмрдиреА рд░рд╣реЗред
рд╣рдореЗрд╢рд╛ рд╡рд┐рдирдореНрд░ рдФрд░ рд╕рд░рд▓ рднрд╛рд╖рд╛ рдореЗрдВ рдмрд╛рдд рдХрд░реЗрдВред рдЖрдк рдЗрдореЛрдЬреА рдХрд╛ рднреА рдЗрд╕реНрддреЗрдорд╛рд▓ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред
"""
# --- рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рд╕рдорд╛рдкреНрдд ---

# Google Gemini AI рдХреЛ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд░реЗрдВ
genai.configure(api_key=GOOGLE_API_KEY)
model = genai.GenerativeModel(
    model_name='gemini-1.5-flash',
    system_instruction=CHARACTER_PROMPT
)

# рдЪреИрдЯ рд╕реЗрд╢рди рд╢реБрд░реВ рдХрд░реЗрдВ
chat = model.start_chat(history=[])

print("Bot is starting...")

# /start рдХрдорд╛рдВрдб рдХреЗ рд▓рд┐рдП рдлрдВрдХреНрд╢рди
async def start(update: Update, context: ContextTypes.DEFAULT_TYPE):
    await update.message.reply_text("рдирдорд╕реНрддреЗ! рдореИрдВ рдЖрдкрдХреА 'рдЪреИрдирд▓ рджреЛрд╕реНрдд' рд╣реВрдБред рдЖрдк рдореБрдЭрд╕реЗ рдХреБрдЫ рднреА рдкреВрдЫ рд╕рдХрддреЗ рд╣реИрдВред ЁЯШК")

# рдореИрд╕реЗрдЬ рд╣реИрдВрдбрд▓ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдлрдВрдХреНрд╢рди
async def handle_message(update: Update, context: ContextTypes.DEFAULT_TYPE):
    user_message = update.message.text
    user_name = update.message.from_user.first_name
    
    print(f"Received message from {user_name}: {user_message}")

    try:
        # Gemini AI рдХреЛ рдореИрд╕реЗрдЬ рднреЗрдЬреЗрдВ
        response = chat.send_message(user_message)
        ai_response = response.text
        
        # AI рдХрд╛ рдЬрд╡рд╛рдм рдпреВрдЬрд░ рдХреЛ рднреЗрдЬреЗрдВ
        await update.message.reply_text(ai_response)

    except Exception as e:
        print(f"Error: {e}")
        await update.message.reply_text("рдорд╛рдлрд╝ рдХреАрдЬрд┐рдпреЗрдЧрд╛, рдХреБрдЫ рд╕рдорд╕реНрдпрд╛ рдЖ рдЧрдпреА рд╣реИред рдХреГрдкрдпрд╛ рдереЛрдбрд╝реА рджреЗрд░ рдмрд╛рдж рдкреНрд░рдпрд╛рд╕ рдХрд░реЗрдВред")

def main():
    # Application рдмрдирд╛рдПрдВ
    app = Application.builder().token(TELEGRAM_BOT_TOKEN).build()

    # рдХрдорд╛рдВрдб рдФрд░ рдореИрд╕реЗрдЬ рд╣реИрдВрдбрд▓рд░ рдЬреЛрдбрд╝реЗрдВ
    app.add_handler(CommandHandler("start", start))
    app.add_handler(MessageHandler(filters.TEXT & ~filters.COMMAND, handle_message))

    # рдмреЙрдЯ рдХреЛ рд╢реБрд░реВ рдХрд░реЗрдВ
    print("Bot is running and waiting for messages...")
    app.run_polling()

if __name__ == '__main__':

    main()
